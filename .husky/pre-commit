#!/bin/bash
. "$(dirname -- "$0")/_/husky.sh"

# Change to project directory
cd "$(dirname "$0")/.."

# Function to find npm/npx
find_npm() {
    # Method 1: Try npx directly
    if command -v npx >/dev/null 2>&1; then
        echo "npx"
        return 0
    fi
    
    # Method 2: Try npm directly
    if command -v npm >/dev/null 2>&1; then
        echo "npm"
        return 0
    fi
    
    # Method 3: Try WSL from Git Bash
    if command -v wsl >/dev/null 2>&1; then
        if wsl -e bash -c "command -v npx" >/dev/null 2>&1; then
            echo "wsl_npx"
            return 0
        fi
    fi
    
    return 1
}

# Find command
CMD=$(find_npm)
if [ $? -ne 0 ]; then
    echo "‚ùå ERROR: npm/npx not found"
    exit 1
fi

# Run lint-staged based on environment
case "$CMD" in
    "npx")
        npx lint-staged
        ;;
    "npm")
        npm run lint-staged
        ;;
    "wsl_npx")
        CURRENT_DIR=$(pwd)
        WSL_PATH=$(echo "$CURRENT_DIR" | sed 's|^/mnt/c|/c|' | sed 's|^/c|/mnt/c|')
        wsl -e bash -c "cd '$WSL_PATH' && npx lint-staged"
        ;;
esac
